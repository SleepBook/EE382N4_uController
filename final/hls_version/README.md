HLS Design
-----

### Files

 - README.md
 - hw/hls\_ip/mvmult.h
 - hw/hls\_ip/mvmult\_accel.cpp
 - hw/hls\_ip/mvmult\_test.cpp
 - hw/hls\_ip/run\_hls\_script.tcl
 - hw/linux\_boot/hls\_mv\_demo.bit
 - hw/linux\_boot/hls\_mv\_demo.dtb
 - hw/linux\_boot/hls\_mv\_demo.dts
 - hw/linux\_boot/uEnv.txt
 - hw/linux\_boot/uImage.bak
 - sw/hls\_mv\_demo/Makefile
 - sw/hls\_mv\_demo/hls\_mv\_demo.c

### Design

#### Hardware

##### Build HLS IP

Under `hw/hls_ip`, we included source files and script file to generate the HLS IP, which accelerates the matrix-vector multiplication. The procedure to build this IP is as below.

1. On ECE LRC machine, load Xilinx modules:
``` bash
module load xilinx/2017.4
```
2. Use Vivado HLS to build the IP:
``` bash
vivado_hls -f run_hls_script.tcl
```
3. Use `xilinx_com_hls_HLS_mv_t_1.0.zip` or `component.xml` in generated IP directory,  `hls_wrapped_mvmult_prj/solution0/impl/ip`, to add IP to IP Catalog in Vivado.

#### Boot up Linux

Under `hw/linux_boot`, we inclued all necessary files to boot up the linux. Copy all files under `hw/linux_boot` to `BOOT` directory of ZedBoard and then reboot the system. To compile `hls_mv_demo.dts`, execute:
``` bash
sudo /usr/src/plnx_kernel/scripts/dtc/dtc -I dts -O dtb -o hls_mv_demo.dtb hls_mv_demo.dts
```

### Software

Under `sw/hls_mv_demo`, a test program to compute matrix-vector multiplication is provided. Input matrix and vector to HLS IP have dimension 128. The output of HLS IP will be compared with reference output which is generated by software. Expected output is printf of orignial destination block, control sequence for DMA and HLS, destination block after computation, and `Matrices identical ... Test successful!`. Nine iterations will be executed to show the robustness of this system.

To compile `hls_mv_demo.c`, execute:
``` bash
make
```
To execute, just type:
``` bash
sudo ./hls_mv_demo
```
To see status of HLS and DMA during execution, add the debug option, `#define DEBUG`, and compile again.

